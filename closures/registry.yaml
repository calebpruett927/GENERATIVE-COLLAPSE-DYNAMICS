# closures/registry.yaml
# Central closure registry for UMCP protocol
# Cross-references: manifest.yaml, contract.yaml, casepacks/*/closures/closure_registry.yaml
# Documentation: docs/interconnected_architecture.md, GLOSSARY.md#closure-registry
schema: "schemas/closures.schema.json"

registry:
  id: "UMCP.CLOSURES.DEFAULT.v1"
  notes: >
    Default closure registry with base closures and GCD/RCFT extensions.
    Version 1.0.0 - includes gamma, return-domain, norms, and curvature-neighborhood defaults.
  closures:
    gamma:
      path: "closures/gamma.default.v1.yaml"
    return_domain:
      path: "closures/return_domain.window64.v1.yaml"
    norms:
      path: "closures/norms.l2_eta1e-3.v1.yaml"
    curvature_neighborhood:
      path: "closures/curvature_neighborhood.default.v1.yaml"
  extensions:
    gcd:
      - name: "energy_potential"
        path: "closures/gcd/energy_potential.py"
        description: "Energy potential computation: E = ω² + α·S + β·C²"
        inputs: ["omega", "S", "C"]
        outputs: ["E_potential", "E_collapse", "E_entropy", "E_curvature", "regime"]
      - name: "entropic_collapse"
        path: "closures/gcd/entropic_collapse.py"
        description: "Entropic collapse potential: Φ_collapse = S·(1-F)·exp(-τ_R/τ_0)"
        inputs: ["S", "F", "tau_R"]
        outputs: ["phi_collapse", "S_contribution", "F_contribution", "tau_damping", "regime"]
      - name: "generative_flux"
        path: "closures/gcd/generative_flux.py"
        description: "Generative flux: Φ_gen = κ·√IC·(1+C²)"
        inputs: ["kappa", "IC", "C"]
        outputs: ["phi_gen", "kappa_component", "IC_amplification", "curvature_modulation", "regime"]
      - name: "field_resonance"
        path: "closures/gcd/field_resonance.py"
        description: "Field resonance: R = (1-|ω|)·(1-S)·exp(-C/C_crit)"
        inputs: ["omega", "S", "C"]
        outputs: ["resonance", "coherence_factor", "order_factor", "curvature_damping", "regime"]
      - name: "momentum_flux"
        path: "closures/gcd/momentum_flux.py"
        description: "Momentum transfer flux: Φ_momentum = (dκ/dt)·√(1+C²)·(1-ω)"
        inputs: ["kappa_series", "C_series", "omega_series", "dt"]
        outputs: ["phi_momentum", "dkappa_dt", "mean_flux", "regime", "net_integrity_change", "flux_variance"]
    rcft:
      - name: "fractal_dimension"
        path: "closures/rcft/fractal_dimension.py"
        description: "Fractal dimension of collapse trajectory: D_f = log(N(ε))/log(1/ε)"
        inputs: ["trajectory", "eps_values"]
        outputs: ["D_fractal", "regime", "box_counts", "r_squared", "log_slope"]
      - name: "recursive_field"
        path: "closures/rcft/recursive_field.py"
        description: "Recursive field strength: Ψ_r = Σ α^n·Ψ_n"
        inputs: ["S_series", "C_series", "F_series", "alpha"]
        outputs: ["Psi_recursive", "regime", "contributions", "convergence_achieved"]
      - name: "resonance_pattern"
        path: "closures/rcft/resonance_pattern.py"
        description: "Resonance pattern analysis: λ_p, Θ via FFT"
        inputs: ["field_series", "dt"]
        outputs: ["lambda_pattern", "Theta_phase", "pattern_type", "phase_coherence"]
      - name: "attractor_basin"
        path: "closures/rcft/attractor_basin.py"
        description: "Attractor basin topology: B = -∇²Ψ_r / ||∇Ψ_r||"
        inputs: ["omega_series", "S_series", "C_series", "psi_r_series"]
        outputs: ["n_attractors_found", "attractor_locations", "basin_strengths", "regime", "convergence_rates", "basin_volumes"]
    optimizations:
      - name: "tau_R_optimized"
        path: "src/umcp/tau_R_optimized.py"
        description: "Optimized return time computation (OPT-7,8,9): Domain caching, Karp cycle detection, vectorized bounds"
        optimizations: ["OPT-7", "OPT-8", "OPT-9"]
        inputs: ["trajectory", "theta", "bounds"]
        outputs: ["tau_R", "cycle_info", "bounds"]
      - name: "kernel_optimized"
        path: "src/umcp/kernel_optimized.py"
        description: "Optimized kernel computations (OPT-1,2,3,4,12,14,15): Lemma-based bounds validation, vectorized invariants"
        optimizations: ["OPT-1", "OPT-2", "OPT-3", "OPT-4", "OPT-12", "OPT-14", "OPT-15"]
        inputs: ["kappa", "omega", "S", "C", "F", "IC"]
        outputs: ["validated", "invariants"]
      - name: "seam_optimized"
        path: "src/umcp/seam_optimized.py"
        description: "Optimized seam chain accumulation (OPT-10,11): ε-closure caching, incremental updates"
        optimizations: ["OPT-10", "OPT-11"]
        inputs: ["seam_chain", "epsilon"]
        outputs: ["accumulated_seam", "graph"]
      - name: "compute_utils"
        path: "src/umcp/compute_utils.py"
        description: "General computational utilities (OPT-17,20): Weight pruning, coordinate clipping, batch processing"
        optimizations: ["OPT-17", "OPT-20"]
        inputs: ["weights", "coordinates", "batch"]
        outputs: ["pruned", "clipped", "statistics"]
    kinematics:
      - name: "linear_kinematics"
        path: "closures/kinematics/linear_kinematics.py"
        description: "Linear kinematics: position, velocity, acceleration with predictions"
        contract: "KIN.INTSTACK.v1"
        inputs: ["x", "v", "a", "dt"]
        outputs: ["position", "velocity", "acceleration", "phase_magnitude", "phase_angle", "predicted_x_next", "predicted_v_next", "regime"]
      - name: "rotational_kinematics"
        path: "closures/kinematics/rotational_kinematics.py"
        description: "Rotational kinematics: angular position, velocity, acceleration, torque"
        contract: "KIN.INTSTACK.v1"
        inputs: ["theta", "omega_rot", "alpha", "I_normalized", "dt"]
        outputs: ["theta", "omega_rot", "alpha", "angular_momentum", "torque", "E_rotational", "regime"]
      - name: "energy_mechanics"
        path: "closures/kinematics/energy_mechanics.py"
        description: "Energy mechanics: kinetic, potential, mechanical energy, work, power"
        contract: "KIN.INTSTACK.v1"
        inputs: ["v", "h", "m_normalized", "F_net", "displacement"]
        outputs: ["E_kinetic", "E_potential", "E_mechanical", "W", "P_power", "regime"]
      - name: "momentum_dynamics"
        path: "closures/kinematics/momentum_dynamics.py"
        description: "Momentum dynamics: linear momentum, impulse, collisions, conservation"
        contract: "KIN.INTSTACK.v1"
        inputs: ["v", "m_normalized", "F_net", "dt"]
        outputs: ["p", "J", "collision_results", "momentum_conserved", "regime"]
      - name: "phase_space_return"
        path: "closures/kinematics/phase_space_return.py"
        description: "Phase space return: τ_kin computation in (x,v) space"
        contract: "KIN.INTSTACK.v1"
        inputs: ["x_series", "v_series", "eta_phase", "H_rec_kin"]
        outputs: ["tau_kin", "return_status", "return_rate", "dynamics_regime"]
      - name: "kinematic_stability"
        path: "closures/kinematics/kinematic_stability.py"
        description: "Kinematic stability: K_stability index, regime classification"
        contract: "KIN.INTSTACK.v1"
        inputs: ["x_series", "v_series", "a_series"]
        outputs: ["K_stability", "S_kin", "C_kin", "omega_kin", "regime", "motion_regime"]
      - name: "kin_ref_phase"
        path: "casepacks/kin_ref_phase_oscillator/closures/kin_ref_phase.py"
        description: "KIN.REF.PHASE: Deterministic phase-anchor selection for oscillatory motion"
        contract: "KIN.INTSTACK.v1"
        inputs: ["x_series", "v_series", "t"]
        outputs: ["anchor_u", "delta_phi", "undefined_reason", "phi", "eligible_count"]
        frozen_params:
          delta_phi_max: 0.5235987756
          window: 20
          debounce: 3
    weyl:
      - name: "weyl_transfer"
        path: "closures/weyl/weyl_transfer.py"
        description: "Weyl transfer function T_{Ψ_W}(k,z) for modified gravity evolution"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["H_z", "J", "D1", "B_boost", "z", "z_star"]
        outputs: ["T_Weyl", "T_ratio", "regime"]
        source: "Nature Comms 15:9295 (2024) Eq. 2"
      - name: "limber_integral"
        path: "closures/weyl/limber_integral.py"
        description: "Limber approximation for C_ℓ (galaxy-galaxy lensing and clustering)"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["n_lens", "n_source", "H_z", "hJ", "hb", "B_boost", "P_lin", "chi", "ell_values"]
        outputs: ["C_ell_ggl", "C_ell_gg", "regime"]
        source: "Nature Comms 15:9295 (2024) Eq. 3, 6"
      - name: "beyond_limber"
        path: "closures/weyl/beyond_limber.py"
        description: "Beyond-Limber correction for ℓ < 200 using spherical Bessel functions"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["n_i", "n_j", "H_z", "hb", "P_lin", "chi", "ell"]
        outputs: ["C_ell_lin", "spherical_bessel_term"]
        source: "Nature Comms 15:9295 (2024) Eq. 7"
      - name: "sigma_evolution"
        path: "closures/weyl/sigma_evolution.py"
        description: "Modified gravity Σ(z) parametrization and ĥJ → Σ mapping"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["hJ", "Omega_m", "D1", "sigma8_star"]
        outputs: ["Sigma", "Sigma_0", "g_z", "regime"]
        source: "Nature Comms 15:9295 (2024) Eq. 11-13"
      - name: "boost_factor"
        path: "closures/weyl/boost_factor.py"
        description: "Nonlinear boost factor B(k,z) = P_nl/P_lin"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["k", "z", "P_lin", "P_nl"]
        outputs: ["B_boost", "nl_correction"]
      - name: "cosmology_background"
        path: "closures/weyl/cosmology_background.py"
        description: "Background cosmology: H(z), χ(z), D₁(z), Ω_m(z), σ8(z)"
        contract: "WEYL.INTSTACK.v1"
        inputs: ["z", "Omega_m_0", "h_0"]
        outputs: ["H_z", "chi", "D1", "Omega_m_z", "sigma8_z"]
        frozen_params:
          Omega_m_0: 0.315
          Omega_Lambda_0: 0.685
          H_0: 67.4
          sigma8_0: 0.811
          n_s: 0.965

    security:
      - name: "trust_fidelity"
        path: "closures/security/trust_fidelity.py"
        description: "Trust Fidelity (T) and Threat Drift (θ) - Tier-1 kernel"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["signals", "weights", "reference"]
        outputs: ["T", "theta", "residual", "regime"]
      - name: "security_entropy"
        path: "closures/security/security_entropy.py"
        description: "Security Entropy (H) and Signal Dispersion (D) - Tier-1 kernel"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["signals", "weights"]
        outputs: ["H", "D", "regime"]
      - name: "trust_integrity"
        path: "closures/security/trust_integrity.py"
        description: "Log-Integrity (σ) and Trust IC (TIC) - Tier-1 kernel"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["signals", "weights"]
        outputs: ["sigma", "TIC", "sigma_components", "regime"]
      - name: "anomaly_return"
        path: "closures/security/anomaly_return.py"
        description: "Anomaly Return Time (τ_A) - Tier-1 kernel"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["t", "signal_history", "eta", "horizon", "weights"]
        outputs: ["tau_A", "baseline", "regime"]
      - name: "threat_classifier"
        path: "closures/security/threat_classifier.py"
        description: "Threat classification from invariants - Tier-2 overlay"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["T", "theta", "H", "D", "sigma", "TIC", "tau_A"]
        outputs: ["threat_type", "confidence", "severity", "recommendations"]
      - name: "reputation_analyzer"
        path: "closures/security/reputation_analyzer.py"
        description: "URL/file/IP reputation analysis - Tier-2 overlay"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["url", "file_hash", "ip_address"]
        outputs: ["reputation_type", "score", "indicators"]
      - name: "behavior_profiler"
        path: "closures/security/behavior_profiler.py"
        description: "Behavior baseline profiling - Tier-2 overlay"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["signal_series", "weights"]
        outputs: ["mean", "std", "percentiles", "trend"]
      - name: "privacy_auditor"
        path: "closures/security/privacy_auditor.py"
        description: "PII detection and privacy audit - Tier-2 overlay"
        contract: "SECURITY.INTSTACK.v1"
        inputs: ["data", "privacy_rules", "consent_records"]
        outputs: ["pii_found", "violations", "privacy_score"]

    finance:
      - name: "finance_embedding"
        path: "closures/finance/finance_embedding.py"
        description: "Financial metric embedding: revenue, expenses, margin, cashflow → [0,1]^4"
        contract: "FINANCE.INTSTACK.v1"
        inputs: ["revenue", "expenses", "cogs", "cashflow", "revenue_target", "expense_budget", "cashflow_target"]
        outputs: ["revenue_performance", "expense_control", "gross_margin", "cashflow_health"]
        frozen_params:
          weights: [0.30, 0.25, 0.25, 0.20]
          epsilon: 1.0e-12

    astronomy:
      - name: "stellar_luminosity"
        path: "closures/astronomy/stellar_luminosity.py"
        description: "Stefan-Boltzmann + mass-luminosity: L = 4πR²σT⁴, L ∝ M^α"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["M_star", "T_eff", "R_star"]
        outputs: ["L_predicted", "L_SB", "delta_L", "lambda_peak", "regime"]
        frozen_params:
          sigma_SB: 5.670374419e-08
          b_Wien: 2897771.955
          ML_alpha_mid: 4.0
      - name: "orbital_mechanics"
        path: "closures/astronomy/orbital_mechanics.py"
        description: "Kepler's third law: P² = (4π²/GM)a³, orbital stability"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["P_orb", "a_semi", "M_total", "e_orb"]
        outputs: ["P_predicted", "kepler_residual", "v_orb", "E_orbital", "regime"]
        frozen_params:
          G_grav: 6.67430e-11
      - name: "spectral_analysis"
        path: "closures/astronomy/spectral_analysis.py"
        description: "Wien's law + B−V calibration + spectral class embedding O-M → [0,1]"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["T_eff", "B_V", "spectral_class"]
        outputs: ["lambda_peak", "T_from_BV", "spectral_embedding", "chi2_spectral", "regime"]
        source: "Wien 1893, Ballesteros 2012 EPL 97:34008"
      - name: "distance_ladder"
        path: "closures/astronomy/distance_ladder.py"
        description: "Multi-method distance: parallax, distance modulus, Hubble flow"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["m_app", "M_abs", "pi_arcsec", "z_cosmo"]
        outputs: ["d_modulus", "d_parallax", "d_hubble", "distance_consistency", "regime"]
        frozen_params:
          H_0_fiducial: 70.0
          c_light: 299800.0
      - name: "gravitational_dynamics"
        path: "closures/astronomy/gravitational_dynamics.py"
        description: "Virial theorem + rotation curves: M_vir = 5σ²R/G, dark matter fraction"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["v_rot", "r_obs", "sigma_v", "M_luminous"]
        outputs: ["M_virial", "M_dynamic", "dark_matter_fraction", "virial_ratio", "regime"]
        frozen_params:
          G_grav: 6.67430e-11
      - name: "stellar_evolution"
        path: "closures/astronomy/stellar_evolution.py"
        description: "Main-sequence lifetime t_MS ≈ M/L · t_sun, evolutionary phase classification"
        contract: "ASTRO.INTSTACK.v1"
        inputs: ["M_star", "L", "T_eff", "age_Gyr"]
        outputs: ["t_MS", "evolutionary_phase", "L_ZAMS", "T_ZAMS", "regime"]
        frozen_params:
          t_sun_MS: 10.0

    quantum_mechanics:
      - name: "wavefunction_collapse"
        path: "closures/quantum_mechanics/wavefunction_collapse.py"
        description: "Born rule validation: P = |⟨φ|ψ⟩|², state fidelity, purity"
        contract: "QM.INTSTACK.v1"
        inputs: ["psi_amplitudes", "measurement_basis", "observed_counts"]
        outputs: ["P_born", "delta_P", "fidelity_state", "purity", "regime"]
      - name: "entanglement"
        path: "closures/quantum_mechanics/entanglement.py"
        description: "Wootters concurrence, von Neumann entropy, Bell-CHSH parameter"
        contract: "QM.INTSTACK.v1"
        inputs: ["rho_eigenvalues", "bell_correlations"]
        outputs: ["concurrence", "S_vN", "bell_parameter", "negativity", "regime"]
        frozen_params:
          bell_classical_limit: 2.0
          bell_quantum_limit: 2.8284
      - name: "tunneling"
        path: "closures/quantum_mechanics/tunneling.py"
        description: "Rectangular barrier: T ≈ exp(-2κL), κ = √(2m(V₀-E))/ℏ"
        contract: "QM.INTSTACK.v1"
        inputs: ["E_particle", "V_barrier", "barrier_width", "particle_mass"]
        outputs: ["T_coeff", "kappa_barrier", "T_classical", "T_ratio", "regime"]
        frozen_params:
          hbar: 1.054571817e-34
          m_electron: 9.1093837015e-31
      - name: "harmonic_oscillator"
        path: "closures/quantum_mechanics/harmonic_oscillator.py"
        description: "Energy quantization E_n = ℏω(n + ½), coherent & squeezed states"
        contract: "QM.INTSTACK.v1"
        inputs: ["n_quanta", "omega_freq", "E_observed"]
        outputs: ["E_predicted", "delta_E", "coherent_alpha", "squeeze_r", "regime"]
      - name: "spin_measurement"
        path: "closures/quantum_mechanics/spin_measurement.py"
        description: "Stern-Gerlach: S_z eigenvalues, Zeeman splitting ΔE = gμ_B·B, Larmor precession"
        contract: "QM.INTSTACK.v1"
        inputs: ["S_total", "S_z_observed", "B_field", "g_factor"]
        outputs: ["S_z_predicted", "spin_fidelity", "larmor_freq", "zeeman_split", "regime"]
        frozen_params:
          mu_B: 9.2740100783e-24
          g_electron: 2.00231930436
      - name: "uncertainty_principle"
        path: "closures/quantum_mechanics/uncertainty_principle.py"
        description: "Heisenberg: Δx·Δp ≥ ℏ/2, ratio R = (Δx·Δp)/(ℏ/2) must be ≥ 1"
        contract: "QM.INTSTACK.v1"
        inputs: ["delta_x", "delta_p", "particle_mass"]
        outputs: ["heisenberg_product", "heisenberg_ratio", "min_uncertainty", "regime"]
        frozen_params:
          hbar_over_2: 5.272859085e-35
